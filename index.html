<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>å•†å‹™è‹±èªæœƒè©±ç‰¹è¨“ (Lesson 1-8)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap');body{font-family:'Noto Sans TC',sans-serif;-webkit-tap-highlight-color:transparent}.font-serif-en{font-family:'Merriweather',serif}@keyframes pulse-red{0%{box-shadow:0 0 0 0 rgba(239,68,68,0.7)}70%{box-shadow:0 0 0 10px rgba(239,68,68,0)}100%{box-shadow:0 0 0 0 rgba(239,68,68,0)}}.animate-pulse-red{animation:pulse-red 1.5s infinite}@keyframes spin-slow{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}.animate-spin-slow{animation:spin-slow 2s linear infinite}.animate-fade-in{animation:fadeIn 0.8s cubic-bezier(0.16,1,0.3,1) forwards}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.blind-mode-blur{filter:blur(6px);user-select:none;transition:filter 0.3s ease;cursor:help}.blind-mode-blur:hover{filter:blur(0px)}.chunk-separator{color:#cbd5e1;font-weight:300;margin:0 6px;display:inline-block;transform:translateY(-1px)}.word-correct{color:#16a34a;font-weight:bold}.word-missed{color:#dc2626;text-decoration:line-through;opacity:0.6}.playing-card{background-color:#eff6ff;border-color:#3b82f6;transform:scale(1.01);transition:all 0.3s ease;box-shadow:0 4px 6px -1px rgba(59,130,246,0.2)}.wave-bar{width:4px;height:10px;background-color:#fff;border-radius:2px;animation:wave 1s ease-in-out infinite}.wave-bar:nth-child(2){animation-delay:0.1s}.wave-bar:nth-child(3){animation-delay:0.2s}.wave-bar:nth-child(4){animation-delay:0.3s}@keyframes slide-up-bounce{0%{transform:translateY(100%);opacity:0}70%{transform:translateY(-10px);opacity:1}100%{transform:translateY(0);opacity:1}}.animate-slide-up-bounce{animation:slide-up-bounce 0.5s cubic-bezier(0.175,0.885,0.32,1.275) forwards}#error-display{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:100000;padding:20px;overflow:auto;color:red;font-family:monospace;font-size:16px;white-space:pre-wrap}</style>
</head>
<body class="bg-gray-50 selection:bg-yellow-100 min-h-screen relative">
<div id="error-display"></div>
<script>window.onerror=function(m,s,l,c,e){const d=document.getElementById('error-display');d.style.display='block';d.innerHTML=`<h1>ğŸ’¥ Error</h1><hr/><strong>Msg:</strong> ${m}<br/><strong>Src:</strong> ${s}<br/><strong>Line:</strong> ${l}`;};</script>
<div id="root"></div><div id="feedback-portal-root"></div>

<script>
// ==========================================
// 1. å–®å­—ç‰¹è¨“ (Vocabulary)
// ==========================================
const vocabData = [
  // --- Lesson 7 ---
  { unitId: "Lesson 7", title: "Lesson 7: Hotel Check-in", desc: "é£¯åº—å…¥ä½å¿…å‚™è©å½™", color: "blue", icon: "Briefcase", words: [
    { word: "Reservation", kk: "[ÍµrÉ›zÉšË‹veÊƒÉ™n]", mean: "é ç´„", tip: "é‡éŸ³åœ¨ vaã€‚tion ç™¼ [ÊƒÉ™n]ã€‚" },
    { word: "Check in", kk: "[tÊƒÉ›k Éªn]", mean: "è¾¦ç†å…¥ä½", tip: "é€£éŸ³å”¸æˆ [tÊƒÉ›-kÉªn]ã€‚" },
    { word: "Passport", kk: "[Ë‹pÃ¦spÉ”rt]", mean: "è­·ç…§", tip: "pass çš„ a ç™¼è´è¶éŸ³ [Ã¦]ï¼Œå˜´å¼µå¤§ã€‚" },
    { word: "Credit card", kk: "[Ë‹krÉ›dÉªt kÉ‘rd]", mean: "ä¿¡ç”¨å¡", tip: "Credit çš„ t è¼•è²ï¼Œå¹¾ä¹ä¸ç™¼éŸ³ã€‚" },
    { word: "Lobby", kk: "[Ë‹lÉ‘bÉª]", mean: "å¤§å»³", tip: "o ç™¼ [É‘] å¤§å£éŸ³ã€‚" },
    { word: "Luggage", kk: "[Ë‹lÊŒgÉªdÊ’]", mean: "è¡Œæ", tip: "ge ç™¼ [dÊ’]ï¼Œé¡ä¼¼ã€Œå±…ã€çš„è¼•éŸ³ã€‚" },
    { word: "Available", kk: "[É™Ë‹velÉ™bl]", mean: "å¯ç”¨çš„/æœ‰ç©ºæˆ¿", tip: "v å’¬ä¸‹å”‡ï¼Œble è¼•è²æ”¶å°¾ã€‚" },
    { word: "Suite", kk: "[swit]", mean: "å¥—æˆ¿", tip: "ç™¼éŸ³åŒ sweetï¼Œä¸è¦å”¸æˆ suitã€‚" },
    { word: "Confirm", kk: "[kÉ™nË‹fÉm]", mean: "ç¢ºèª", tip: "firm çš„ ir æ²èˆŒã€‚" },
    { word: "Elevator", kk: "[Ë‹É›lÉ™ÍµvetÉš]", mean: "é›»æ¢¯", tip: "é‡éŸ³åœ¨æœ€å‰ï¼Œtor æ²èˆŒã€‚" }
  ]},
  // --- Lesson 8 (New) ---
  { unitId: "Lesson 8", title: "Lesson 8: Dress Code", desc: "æœè£å„€å®¹ç™¼éŸ³ç‰¹è¨“ï¼š[p] ä¸é€æ°£èˆ‡é‡éŸ³æŠ€å·§", color: "purple", icon: "Settings", words: [
    { word: "Reception", kk: "[rÉªË‹sÉ›pÊƒÉ™n]", mean: "æ­¡è¿æœƒ", tip: "[p] é–‰å”‡ç·´ç¿’ã€‚é‡éŸ³åœ¨ sepï¼Œå”¸åˆ° p æ™‚é›™å”‡è¼•é–‰å†ç™¼ shunã€‚" },
    { word: "Cocktail", kk: "[Ë‹kÉ‘kÍµtel]", mean: "é›å°¾é…’", tip: "é‡éŸ³ç¬¬ä¸€éŸ³ç¯€ã€‚tail æ˜¯é•·æ¯éŸ³ [e]ï¼Œå˜´è§’æ‹‰é–‹ã€‚" },
    { word: "Dress code", kk: "[drÉ›s kod]", mean: "è‘—è£æ¨™æº–", tip: "Code æ¯éŸ³ [o] é£½æ»¿ï¼Œçµå°¾ [d] è¼•å¸¶éï¼Œå‹¿ç™¼æˆ code-uhã€‚" },
    { word: "Formal", kk: "[Ë‹fÉ”rmÉ™l]", mean: "æ­£å¼", tip: "[É”r] å˜´åœ“æ²èˆŒã€‚çµå°¾ [l] èˆŒå°–é ‚ä¸Šé½’é½¦ã€‚" },
    { word: "Registered", kk: "[Ë‹rÉ›dÊ’ÉªstÉšd]", mean: "å ±åçš„", tip: "g ç™¼ [dÊ’] å˜Ÿå˜´ã€‚å­—å°¾ [d] è¼•è²å”¸å‡ºã€‚" },
    { word: "Potential", kk: "[pÉ™Ë‹tÉ›nÊƒÉ™l]", mean: "æ½›åœ¨çš„", tip: "é‡éŸ³ tenã€‚æ³¨æ„ [t] é€æ°£èˆ‡çµå°¾é¼»éŸ³ [n]ã€‚" },
    { word: "Exhibitor", kk: "[ÉªgË‹zÉªbÉªtÉš]", mean: "åƒå±•å•†", tip: "é‡éŸ³åœ¨ ziã€‚x ç™¼ [gz] æ¿éŸ³ã€‚" },
    { word: "Attire", kk: "[É™Ë‹taÉªr]", mean: "æœè£", tip: "é‡éŸ³åœ¨å¾Œã€‚ire æ˜¯æ²èˆŒé›™æ¯éŸ³ï¼Œå°¾éŸ³æ‹‰é•·å›æ²ã€‚" },
    { word: "Engage", kk: "[ÉªnË‹gedÊ’]", mean: "æ¥å¾…/äº’å‹•", tip: "é‡éŸ³ gageã€‚çµå°¾ [dÊ’] åšå¯¦æœ‰éœ‡å‹•æ„Ÿã€‚" },
    { word: "Professional", kk: "[prÉ™Ë‹fÉ›ÊƒÉ™nÉ™l]", mean: "å°ˆæ¥­çš„", tip: "[p] çˆ†ç ´ã€‚é‡éŸ³ feshã€‚çµå°¾ nal èˆŒå°–é ‚ä¸Šã€‚" },
    { word: "Opportunity", kk: "[ÍµÉ‘pÉšË‹tjunÉ™tÉª]", mean: "æ©Ÿæœƒ", tip: "[p] åœ¨æ¯éŸ³é–“ã€‚é‡éŸ³ tuã€‚åˆ†æ®µç·´ï¼šop-per-tu-ni-tyã€‚" },
    { word: "Expand", kk: "[ÉªkË‹spÃ¦nd]", mean: "æ“´å±•", tip: "[p] ä¸é€æ°£ã€‚s å¾Œé¢çš„ p å”¸åƒã€Œã„…ã€ã€‚" },
    { word: "Tuxedo", kk: "[tÊŒkË‹sido]", mean: "(ç¾)æ™šç¦®æœ", tip: "é‡éŸ³ xiã€‚x ç™¼ [ks]ï¼Œ[k] è¼•éŸ³æ¥ [s]ã€‚" },
    { word: "Lounge suit", kk: "[laÊŠndÊ’ sut]", mean: "(è‹±)è¥¿è£", tip: "Lounge [dÊ’] å˜Ÿå˜´ã€‚suit [u] é•·éŸ³å˜´åœ“ã€‚" },
    { word: "Casual", kk: "[Ë‹kÃ¦Ê’ÊŠÉ™l]", mean: "ä¼‘é–’çš„", tip: "é‡éŸ³ç¬¬ä¸€ã€‚ä¸­é–“ [Ê’] åƒã€Œæ—¥ã€ä½†æœ‰æ°£æµæ‘©æ“¦ã€‚" },
    { word: "Comfortable", kk: "[Ë‹kÊŒmfÉštÉ™bl]", mean: "èˆ’é©çš„", tip: "æ˜“éŒ¯ï¼é‡éŸ³ comï¼Œä¸­é–“ for è¼•è®€ç¸®çŸ­ã€‚" },
    { word: "Exhibition", kk: "[ÍµÉ›ksÉ™Ë‹bÉªÊƒÉ™n]", mean: "å±•è¦½", tip: "é‡éŸ³åœ¨ biï¼Œx ç™¼ [ks]ã€‚" },
    { word: "Sparkling", kk: "[Ë‹spÉ‘rklÉªÅ‹]", mean: "æ°£æ³¡çš„", tip: "[p] ä¸é€æ°£ã€‚åƒã€Œæ­»å…«-klingã€ï¼Œå‹¿å™´æ°£ã€‚" },
    { word: "Attendee", kk: "[É™ÍµtÉ›nË‹di]", mean: "åƒåŠ è€…", tip: "é‡éŸ³å­—å°¾ deeã€‚é›™ e ç™¼é•·éŸ³ [i]ã€‚" },
    { word: "Suggestion", kk: "[sÉ™Ë‹dÊ’É›stÊƒÉ™n]", mean: "å»ºè­°", tip: "g ç™¼ [dÊ’]ã€‚çµå°¾ stion å”¸ [stÊƒÉ™n]ã€‚" }
  ]}
];

// ==========================================
// 2. å¥å‹è·Ÿè®€ (Sentences)
// ==========================================
const sentenceData = [
  // --- Lesson 7 ---
  { id: "L7-p1", unitId: "Lesson 7", category: "1. Check-in Request", desc: "æå‡ºå…¥ä½éœ€æ±‚", colorTheme: "blue", icon: "Briefcase", sentences: [
    { id: "s7-1", plain: "I'd like to check in, please.", text: "I'd like to <u>check in</u>, please.", mean: "ä½ å¥½ï¼Œæˆ‘æƒ³è¾¦ç†å…¥ä½ã€‚", tip: "Check in é€£éŸ³ [tÊƒÉ›-kÉªn]ã€‚", type: "Request" },
    { id: "s7-2", plain: "I have a reservation under the name of Lin.", text: "I have a <u>reservation</u> under the name of Lin.", mean: "æˆ‘æœ‰ç”¨æ—çš„åå­—é ç´„ã€‚", tip: "Reservation é‡éŸ³åœ¨ vaã€‚", type: "Statement" }
  ]},
  // --- Lesson 8 (New) ---
  { id: "L8-part1", unitId: "Lesson 8", category: "1. Discussing the Evening Plan", desc: "è¨è«–æ™šé–“è¡Œç¨‹", colorTheme: "purple", icon: "MessageCircle", sentences: [
    { id: "s8-1", plain: "Hi, Ken. What's up?", text: "Hi, Ken. <u>What's up</u>?", mean: "å—¨ï¼ŒKenã€‚æ€éº¼äº†ï¼Ÿ", tip: "What's up å¿…é€£éŸ³ [hwÉ‘-tsÊŒp]ã€‚", type: "Greeting" },
    { id: "s8-2", plain: "Are you going to the dinner reception this evening?", text: "Are you <u>going to</u> the <u>dinner reception</u> this evening?", mean: "ä½ ä»Šæ™šæœƒå»åƒåŠ æ­¡è¿æ™šå®´å—ï¼Ÿ", tip: "Going to å¸¸ç¸®è®€ç‚º gonnaã€‚Reception é‡éŸ³ç¬¬äºŒéŸ³ç¯€ã€‚", type: "Question" },
    { id: "s8-3", plain: "Of course! That's the best part of a trade show.", text: "Of course! That's the best part of a <u>trade show</u>.", mean: "ç•¶ç„¶ï¼é‚£æ˜¯è²¿æ˜“å±•æœ€æ£’çš„éƒ¨åˆ†ã€‚", tip: "Trade show è¤‡åˆåè©é‡éŸ³åœ¨å‰ã€‚", type: "Statement" },
    { id: "s8-4", plain: "I'm looking forward to it.", text: "I'm <u>looking forward to</u> it.", mean: "æˆ‘å¾ˆæœŸå¾…å‘¢ã€‚", tip: "forward èˆ‡ to é€£è®€ï¼Œit çš„ [t] è¼•åœã€‚", type: "Statement" },
    { id: "s8-5", plain: "I can't wait to put on my cocktail dress.", text: "I <u>can't wait to</u> put on my <u>cocktail dress</u>.", mean: "æˆ‘ç­‰ä¸åŠè¦ç©¿ä¸Šæˆ‘çš„é›å°¾é…’ç¦®æœã€‚", tip: "Can't wait to çš„ t çœç•¥ã€‚Cocktail é‡éŸ³ cockã€‚", type: "Statement" }
  ]},
  { id: "L8-part2", unitId: "Lesson 8", category: "2. Clarifying the Dress Code", desc: "ç¢ºèªè‘—è£æ¨™æº–", colorTheme: "indigo", icon: "Filter", sentences: [
    { id: "s8-6", plain: "Cocktail dress? Is there a dress code?", text: "Cocktail dress? Is there a <u>dress code</u>?", mean: "é›å°¾é…’ç¦®æœï¼Ÿæœ‰è¦å®šè‘—è£æ¨™æº–å—ï¼Ÿ", tip: "Dress code çµå°¾ s æ¥ kï¼ŒèˆŒé ­å¿«ç§»ã€‚å•å¥ä¸Šæšã€‚", type: "Question" },
    { id: "s8-7", plain: "It's not a black tie event, but it's definitely formal, though.", text: "It's not a <u>black tie event</u>, but it's <u>definitely formal</u>, though.", mean: "ä¸è‡³æ–¼è¦æ‰“é»‘é ˜çµï¼Œä½†ä¹Ÿç®—æ˜¯æ­£å¼å ´åˆã€‚", tip: "Black tie é€£è®€ã€‚Formal çš„ [l] é ‚ä¸Šé½’é½¦ã€‚", type: "Statement" },
    { id: "s8-8", plain: "Most registered exhibitors and potential buyers are going to be there.", text: "Most <u>registered exhibitors</u> and <u>potential buyers</u> are going to be there.", mean: "å¤§å¤šæ•¸åƒå±•å•†å’Œæ½›åœ¨å®¢æˆ¶éƒ½æœƒå‡ºå¸­ã€‚", tip: "Registered [d] è¼•å”¸ã€‚Buyers çš„ s ç™¼ [z]ã€‚", type: "Statement" },
    { id: "s8-9", plain: "So, no jeans or T-shirts are allowed.", text: "So, no <u>jeans</u> or <u>T-shirts</u> are allowed.", mean: "å› æ­¤ï¼Œç‰›ä»”è¤²æˆ– T-shirt éƒ½ä¸è¡Œã€‚", tip: "Are allowed é€£éŸ³ [ar-É™-laÊŠd]ã€‚", type: "Rule" }
  ]},
  { id: "L8-part3", unitId: "Lesson 8", category: "3. Expressing Personal Feelings", desc: "è¡¨é”å€‹äººæ„Ÿå—", colorTheme: "blue", icon: "User", sentences: [
    { id: "s8-10", plain: "I thought it's business casual.", text: "I <u>thought it's</u> <u>business casual</u>.", mean: "æˆ‘ä»¥ç‚ºæ˜¯å•†å‹™ä¼‘é–’å ´åˆã€‚", tip: "Thought it's é€£éŸ³ [Î¸É”-tÉªts]ã€‚Casual å˜Ÿå˜´æ‘©æ“¦ã€‚", type: "Statement" },
    { id: "s8-11", plain: "I was planning to get there in this attire after the closing of the trade show.", text: "I was planning to get there in this <u>attire</u> after the <u>closing</u> of the trade show.", mean: "æˆ‘æœ¬ä¾†æ‰“ç®—å±•è¦½çµæŸå¾Œç›´æ¥ç©¿é€™å¥—å»ã€‚", tip: "Attire é‡éŸ³åœ¨å¾Œã€‚Closing çš„ s ç™¼ [z]ã€‚", type: "Statement" },
    { id: "s8-12", plain: "I have been standing and engaging attendees for long hours.", text: "I have been <u>standing and engaging</u> <u>attendees</u> for long hours.", mean: "æˆ‘å·²é•·æ™‚é–“ç«™è‘—æ¥å¾…ä¾†è³“ã€‚", tip: "Standing and çš„ d å¯çœã€‚Attendees é‡éŸ³å­—å°¾ã€‚", type: "Statement" },
    { id: "s8-13", plain: "I know it's hard to be comfortable and professional at the same time.", text: "I know it's hard to be <u>comfortable</u> and <u>professional</u> at the <u>same time</u>.", mean: "æˆ‘çŸ¥é“è¦å…¼é¡§èˆ’é©èˆ‡å°ˆæ¥­å¾ˆé›£ã€‚", tip: "Same time çš„ m é–‰å˜´å¾Œç›´ç™¼ tã€‚Professional é‡éŸ³ feshã€‚", type: "Statement" }
  ]},
  { id: "L8-part4", unitId: "Lesson 8", category: "4. Final Advice and Conclusion", desc: "æœ€çµ‚å»ºè­°èˆ‡çµè«–", colorTheme: "teal", icon: "Check", sentences: [
    { id: "s8-14", plain: "I can cover your shift if you need to go back to the hotel to dress up.", text: "I can <u>cover your shift</u> if you need to <u>go back</u> to the hotel to <u>dress up</u>.", mean: "è‹¥ä½ éœ€è¦å›é£¯åº—æ‰“æ‰®ï¼Œæˆ‘å¯ä»¥ä»£ç­ã€‚", tip: "Dress up é€£éŸ³ [drÉ›-sÊŒp]ã€‚", type: "Offer" },
    { id: "s8-15", plain: "The reception begins at 7:00 p.m., right?", text: "The <u>reception</u> begins at 7:00 p.m., right?", mean: "æ™šå®´ä¸ƒé»é–‹å§‹å°å—ï¼Ÿ", tip: "Begins çš„ s ç™¼ [z]ã€‚Right èªæ°£ä¸Šæšã€‚", type: "Question" },
    { id: "s8-16", plain: "You still have two hours to freshen yourself up.", text: "You still have two hours to <u>freshen yourself up</u>.", mean: "ä½ é‚„æœ‰å…©å°æ™‚å¯ä»¥æ¢³æ´—æ‰“æ‰®ã€‚", tip: "Freshen yourself up ä¸‰å­—é€£è®€ï¼Œup çš„ p è¼•çˆ†ã€‚", type: "Advice" },
    { id: "s8-17", plain: "If you hurry, you might be able to get a glass of sparkling wine before dinner.", text: "If you <u>hurry</u>, you might be able to get a glass of <u>sparkling wine</u> before dinner.", mean: "å‹•ä½œå¿«é»ä¹Ÿè¨±èƒ½è¶•ä¸Šå–æ¯æ°£æ³¡é…’ã€‚", tip: "Sparkling çš„ p ä¸é€æ°£ã€‚Wine çµå°¾ [n] é ‚ä¸Šé¡ã€‚", type: "Suggestion" },
    { id: "s8-18", plain: "Do I really have to go? John asked me to attend the dinner reception, but I'm really not into it.", text: "Do I really have to go? John asked me to <u>attend the dinner reception</u>, but I'm really <u>not into it</u>.", mean: "æˆ‘çœŸçš„å¾—å»å—ï¼ŸJohn å«æˆ‘å»ï¼Œä½†æˆ‘çœŸçš„æ²’èˆˆè¶£ã€‚", tip: "Not into it é€£è®€ [nÉ‘-tÉªn-tu-wÉªt]ã€‚", type: "Complaint" },
    { id: "s8-19", plain: "Actually, I am not a people-person.", text: "Actually, I am not a <u>people-person</u>.", mean: "è€å¯¦èªªï¼Œæˆ‘ä¸æ“…é•·äº¤éš›ã€‚", tip: "People-person é‡éŸ³éƒ½åœ¨ç¬¬ä¸€éŸ³ç¯€ã€‚", type: "Statement" },
    { id: "s8-20", plain: "It's an order, not a suggestion. Remember, he's the boss.", text: "It's an <u>order</u>, not a <u>suggestion</u>. Remember, he's the boss.", mean: "é€™æ˜¯å‘½ä»¤ä¸æ˜¯å»ºè­°ã€‚è¨˜ä½ä»–æ˜¯è€é—†ã€‚", tip: "Order é‡éŸ³åœ¨å‰ã€‚Remember å˜´åœ“ã€‚", type: "Warning" },
    { id: "s8-21", plain: "You can say that again. Maybe it's a good opportunity to expand social networking for our business.", text: "<u>You can say that again</u>. Maybe it's a good <u>opportunity</u> to <u>expand</u> social networking for our business.", mean: "èªªå¾—ä¹Ÿæ˜¯ã€‚ä¹Ÿè¨±é€™æ˜¯æ“´å±•æ¥­å‹™äººè„ˆçš„å¥½æ©Ÿæœƒã€‚", tip: "You can say that again è¡¨ç¤ºå¼·çƒˆåŒæ„ã€‚", type: "Conclusion" }
  ]}
];

// ==========================================
// 3. ä»‹ä¿‚è©/ç‰‡èªç”¨æ³• (Prepositions & Phrases)
// ==========================================
const prepData = [
  // --- Lesson 7 ---
  { id: "L7-p1", unitId: "Lesson 7", phrase: "check in", plain: "I'd like to check in.", sentence: "I'd like to <b>check in</b>.", mean: "è¾¦ç†å…¥ä½", tip: "Check èˆ‡ in é€£éŸ³" },
  // --- Lesson 8 (New) ---
  { id: "L8-p1", unitId: "Lesson 8", phrase: "look forward to", plain: "I look forward to it.", sentence: "I <b>look forward to</b> it.", mean: "æœŸå¾… (to ç‚ºä»‹ä¿‚è©ï¼Œå¾Œæ¥åè©/Ving)", tip: "to å¼±è®€ç‚º [tÉ™]ï¼Œé€£éŸ³é †æš¢ã€‚" },
  { id: "L8-p2", unitId: "Lesson 8", phrase: "put on", plain: "I can't wait to put on my dress.", sentence: "I can't wait to <b>put on</b> my dress.", mean: "ç©¿ä¸Š (å¼·èª¿å‹•ä½œ)", tip: "Put çš„ t èˆ‡ on é€£éŸ³è®Š [pÊŠ-tÉ‘n]ã€‚" },
  { id: "L8-p3", unitId: "Lesson 8", phrase: "dress up", plain: "You need to dress up for the party.", sentence: "You need to <b>dress up</b> for the party.", mean: "ç››è£æ‰“æ‰®", tip: "Dress çš„ s èˆ‡ up é€£éŸ³ [drÉ›-sÊŒp]ã€‚" },
  { id: "L8-p4", unitId: "Lesson 8", phrase: "go back to", plain: "I need to go back to the hotel.", sentence: "I need to <b>go back to</b> the hotel.", mean: "å›åˆ°...å»", tip: "Back çš„ k è¼•é “ï¼Œä¸éœ€å¼·åŠ›çˆ†ç ´ã€‚" },
  { id: "L8-p5", unitId: "Lesson 8", phrase: "not into it", plain: "I'm really not into it.", sentence: "I'm really <b>not into it</b>.", mean: "å°...ä¸æ„Ÿèˆˆè¶£/ä¸ç†±è¡·", tip: "é€£è®€æŠ€å·§ï¼š[nÉ‘-tÉªn-tu-wÉªt]ã€‚" },
  { id: "L8-p6", unitId: "Lesson 8", phrase: "freshen up", plain: "Time to freshen yourself up.", sentence: "Time to <b>freshen yourself up</b>.", mean: "æ¢³æ´—ä¸€ç•ª (è®“è‡ªå·±ç²¾ç¥ç…¥ç™¼)", tip: "Sh éŸ³èˆ‡ up é€£æ¥ï¼Œæµæš¢å¸¶éã€‚" }
];
</script>

<script type="text/babel">
const{useState,useEffect,useRef,useMemo,useCallback}=React;const{createPortal}=ReactDOM;
let globalRecognition=null;let globalTimeout=null;let globalUtterance=null;
const getSharedRecognition=()=>{if(!globalRecognition){const S=window.SpeechRecognition||window.webkitSpeechRecognition;if(S){globalRecognition=new S();globalRecognition.lang='en-US';globalRecognition.interimResults=false;globalRecognition.maxAlternatives=1;globalRecognition.continuous=false;}}return globalRecognition;};
const Icon=({children,className,...p})=><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...p}>{children}</svg>;
const Briefcase=(p)=><Icon {...p}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></Icon>;
const BookOpen=(p)=><Icon {...p}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></Icon>;
const MessageCircle=(p)=><Icon {...p}><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></Icon>;
const Link2=(p)=><Icon {...p}><path d="M9 17H7A5 5 0 0 1 7 7h2"/><path d="M15 7h2a5 5 0 1 1 0 10h-2"/><line x1="8" x2="16" y1="12" y2="12"/></Icon>;
const Play=(p)=><Icon {...p}><polygon points="5 3 19 12 5 21 5 3"/></Icon>;
const Turtle=(p)=><Icon {...p}><path d="m19 12-1.5 3"/><path d="M16.5 10.5 19 8"/><path d="m7 16 1.5 3"/><path d="M7.5 10.5 5 8"/><path d="M12 21a6 6 0 0 0 6-6v-2a6 6 0 0 0-6-6 6 6 0 0 0-6 6v2a6 6 0 0 0 6 6Z"/><path d="M12 21V9"/><path d="M12 21a4 4 0 0 1-4-4H6"/><path d="M12 21a4 4 0 0 0 4-4h2"/></Icon>;
const Volume2=(p)=><Icon {...p}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></Icon>;
const Info=(p)=><Icon {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
const Trash2=(p)=><Icon {...p}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
const X=(p)=><Icon {...p}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></Icon>;
const Save=(p)=><Icon {...p}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>;
const Lightbulb=(p)=><Icon {...p}><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1 1.5-2 1.5-3.5 0-3-2.5-5.5-5.5-5.5S7 5 7 8c0 1.5.5 2.5 1.5 3.5.8.8 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></Icon>;
const Feather=(p)=><Icon {...p}><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" x2="2" y1="8" y2="22"/><line x1="17.5" x2="9" y1="15" y2="15"/></Icon>;
const Layout=(p)=><Icon {...p}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></Icon>;
const MapPin=(p)=><Icon {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></Icon>;
const Zap=(p)=><Icon {...p}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>;
const Mic=(p)=><Icon {...p}><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></Icon>;
const Check=(p)=><Icon {...p}><polyline points="20 6 9 17 4 12"/></Icon>;
const AlertCircle=(p)=><Icon {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></Icon>;
const MousePointerClick=(p)=><Icon {...p}><path d="M14 4.1 12 6"/><path d="m5.1 8-2.9-.8"/><path d="m6 12-1.9 2"/><path d="M7.2 2.2 8 5.1"/><path d="M9.037 9.69a.498.498 0 0 1 .653-.653l11 4.5a.5.5 0 0 1-.074.949l-4.349 1.041a1 1 0 0 0-.74.739l-1.04 4.35a.5.5 0 0 1-.95.074z"/></Icon>;
const Filter=(p)=><Icon {...p}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></Icon>;
const Settings=(p)=><Icon {...p}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
const Wifi=(p)=><Icon {...p}><path d="M5 12.55a11 11 0 0 1 14.08 0"/><path d="M1.42 9a16 16 0 0 1 21.16 0"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></Icon>;
const Eye=(p)=><Icon {...p}><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></Icon>;
const EyeOff=(p)=><Icon {...p}><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"/><line x1="2" x2="22" y1="2" y2="22"/></Icon>;
const Scissors=(p)=><Icon {...p}><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" x2="8.12" y1="4" y2="15.88"/><line x1="14.47" x2="20" y1="14.48" y2="20"/><line x1="8.12" x2="12" y1="8.12" y2="12"/></Icon>;
const Loader2=(p)=><Icon {...p}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></Icon>;
const CreditCard=(p)=><Icon {...p}><rect width="20" height="14" x="2" y="5" rx="2" ry="2"/><line x1="2" x2="22" y1="10" y2="10"/></Icon>;
const AlertTriangle=(p)=><Icon {...p}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></Icon>;
const Repeat=(p)=><Icon {...p}><path d="m17 2 4 4-4 4"/><path d="M3 11v-1a4 4 0 0 1 4-4h14"/><path d="m7 22-4-4 4-4"/><path d="M21 13v1a4 4 0 0 1-4 4H3"/></Icon>;
const PauseCircle=(p)=><Icon {...p}><circle cx="12" cy="12" r="10"/><line x1="10" x2="10" y1="15" y2="9"/><line x1="14" x2="14" y1="15" y2="9"/></Icon>;
const IconMap={Briefcase,BookOpen,MessageCircle,Link2,Play,Turtle,Volume2,Info,Trash2,X,Save,Lightbulb,Feather,Layout,MapPin,Zap,Mic,Check,AlertCircle,MousePointerClick,Filter,Settings,Wifi,Eye,EyeOff,Scissors,Loader2,CreditCard,AlertTriangle,Repeat,PauseCircle};
const speakText=(t,r=0.85,c=null)=>{window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(t);globalUtterance=u;u.lang='en-US';u.rate=r;if(c){u.onend=(e)=>{c(e);};}u.onerror=(e)=>{console.error("SpeechSynthesis Error:",e);if(c)c(e);};window.speechSynthesis.speak(u);};
const cleanText=(t)=>{if(!t)return"";return t.replace(/<[^>]*>/g,'').replace(/[.,\/#!$%\^&\*;:{}=\-_`~?]/g,"").replace(/\s{2,}/g," ").trim().toLowerCase();};
const renderChunkedText=(h,s)=>{if(!s)return<InteractiveSentence htmlContent={h}/>;const p=h.split(/(<[^>]+>)/g);const c=p.map((x)=>{if(x.startsWith('<'))return x;return x.replace(/([,.;?])/g,"$1<span class='chunk-separator'>|</span>").replace(/\s(and|but|or|because|that|which|where|when)\s/gi," <span class='chunk-separator'>|</span> $1 ");});return<InteractiveSentence htmlContent={c.join('')}/>;};
const InteractiveSentence=({htmlContent,isBlindMode})=>{const regex=/(<span class='[^']+'>.*?<\/span>)|([^<]+)/g;const parts=htmlContent.match(regex)||[];const handleWordClick=(e,w)=>{e.stopPropagation();const cw=w.replace(/[.,?!:;|]/g,'');if(cw.trim())speakText(cw,0.75);};return(<span className={`leading-relaxed transition-all duration-500 ${isBlindMode?'blind-mode-blur':''}`}>{parts.map((p,i)=>{if(p.startsWith('<span')){const cm=p.match(/class='([^']+)'/);const cn=cm?cm[1]:'';const ctm=p.match(/>(.*?)</);const c=ctm?ctm[1]:'';if(cn.includes('chunk-separator'))return<span key={i} className={cn} dangerouslySetInnerHTML={{__html:c}}></span>;const ws=c.split(' ');return(<span key={i} className={cn}>{ws.map((w,wi)=>(<React.Fragment key={wi}><span className="cursor-pointer hover:bg-yellow-200 hover:text-black rounded px-0.5 transition-colors active:scale-95 inline-block" onClick={(e)=>handleWordClick(e,w)}>{w}</span>{wi<ws.length-1&&' '}</React.Fragment>))}</span>);}else{const ws=p.split(' ');return<span key={i}>{ws.map((w,wi)=><React.Fragment key={wi}><span className="cursor-pointer hover:bg-yellow-200 hover:text-black rounded px-0.5 transition-colors active:scale-95 inline-block" onClick={(e)=>handleWordClick(e,w)}>{w}</span>{wi<ws.length-1&&' '}</React.Fragment>)}</span>;}})}</span>);};
const RenderComparison=({feedback})=>{if(!feedback||!feedback.spokenText)return null;const tw=cleanText(feedback.targetText).split(' ');const sw=cleanText(feedback.spokenText).split(' ');return(<div className="mt-2 text-sm bg-white p-3 rounded border border-gray-200 shadow-inner">{feedback.advice&&(<div className="mb-2 pb-2 border-b border-gray-100 bg-yellow-50 p-2 rounded"><div className="text-yellow-700 text-xs font-bold mb-1 flex items-center"><Lightbulb className="w-3 h-3 mr-1"/>æ•™ç·´çš„ç™¼éŸ³è¨ºæ–·ï¼š</div><div className="text-gray-700 text-sm font-medium">{feedback.advice}</div></div>)}<div className="mb-1 text-gray-500 text-xs">è¾¨è­˜çµæœæ¯”å° (åš´æ ¼æ¨¡å¼)ï¼š</div><div className="mb-2">{tw.map((w,i)=>{const m=sw.some(x=>x===w||(x.length>3&&(x.includes(w)||w.includes(x))));return<span key={i} className={`mr-1 ${m?'word-correct':'word-missed'}`}>{w}</span>;})}</div><div className="mt-1 text-xs text-gray-400">(æˆ‘è½åˆ°: <span className="text-gray-600 italic">{feedback.spokenText}</span>)</div></div>);};
const MobileFeedbackToast=({feedback,showDetails,toggleDetails,onClose})=>{if(!feedback)return null;const pr=document.getElementById('feedback-portal-root');if(!pr)return null;return createPortal(<div className={`md:hidden fixed bottom-0 left-0 right-0 z-[99999] p-4 pb-8 rounded-t-2xl shadow-[0_-8px_40px_rgba(0,0,0,0.3)] border-t transition-transform duration-300 animate-slide-up-bounce bg-white ${feedback.type==='success'?'border-green-400 bg-green-50 ring-4 ring-green-100':feedback.type==='warning'?'border-yellow-300 bg-yellow-50':feedback.type==='error'?'border-red-300 bg-red-50':'border-blue-300 bg-blue-50'}`}><div className="flex items-center justify-between gap-2 mb-2"><div className="flex items-center gap-2 overflow-hidden">{feedback.type==='success'&&<Check className="w-6 h-6 text-green-600 flex-shrink-0 animate-bounce"/>}{feedback.type==='warning'&&<AlertCircle className="w-6 h-6 text-yellow-600 flex-shrink-0"/>}{feedback.type==='error'&&<X className="w-6 h-6 text-red-600 flex-shrink-0"/>}<span className={`font-bold text-lg truncate ${feedback.type==='success'?'text-green-800':'text-slate-800'}`}>{feedback.text} {feedback.score!==undefined&&`(${feedback.score}%)`}</span></div><div className="flex gap-2 flex-shrink-0">{feedback.spokenText&&<button onClick={toggleDetails} className="px-4 py-2 bg-white rounded-full text-sm font-bold shadow-sm border border-gray-100 active:bg-gray-100 transition-all text-slate-700">{showDetails?'éš±è—':'è©³æƒ…'}</button>}<button onClick={onClose} className="w-9 h-9 flex items-center justify-center bg-white rounded-full text-gray-400 hover:text-red-500 shadow-sm border border-gray-100 active:bg-gray-100 transition-all"><X className="w-5 h-5"/></button></div></div>{showDetails&&<div className="max-h-[50vh] overflow-y-auto overscroll-contain pb-2 mt-3 bg-white/50 rounded-xl p-2 animate-fade-in"><RenderComparison feedback={feedback}/></div>}</div>,pr);};
const VoiceEvaluatorButton=({id,status,feedback,showDetails,toggleDetails,onRecord})=>{let bc="bg-white text-gray-500 border-gray-200 hover:bg-gray-50 hover:text-blue-600";let ic=<Mic className="w-5 h-5"/>;if(status==='init'){bc="bg-yellow-100 text-yellow-600 border-yellow-300";ic=<Loader2 className="w-5 h-5 animate-spin-slow"/>;}else if(status==='listening'){bc="bg-red-500 text-white border-red-500 animate-pulse-red";ic=<div className="text-xs font-bold font-sans">GO!</div>;}return(<div className="relative inline-block ml-2 text-left"><button onClick={(e)=>{e.stopPropagation();onRecord(id);}} className={`flex items-center justify-center w-10 h-10 rounded-full border shadow-sm transition-all ${bc}`} title="é»æ“Šé–‹å§‹éŒ„éŸ³">{ic}</button>{status==='init'&&<div className="absolute top-full left-1/2 -translate-x-1/2 mt-1 text-[10px] text-yellow-600 font-bold whitespace-nowrap">æº–å‚™ä¸­...</div>}{feedback&&(<div className={`hidden md:block absolute top-full right-0 mt-2 p-3 rounded-lg text-sm font-bold whitespace-normal min-w-[300px] z-30 shadow-xl border animate-fade-in ${feedback.type==='success'?'bg-green-50 text-green-800 border-green-200':feedback.type==='warning'?'bg-yellow-50 text-yellow-800 border-yellow-200':feedback.type==='error'?'bg-red-50 text-red-800 border-red-200':'bg-blue-50 text-blue-800 border-blue-200'}`}><div className="flex items-center justify-between gap-2"><div className="flex items-center gap-2">{feedback.type==='success'&&<Check className="w-4 h-4 text-green-600"/>}{feedback.type==='warning'&&<AlertCircle className="w-4 h-4 text-yellow-600"/>}{feedback.type==='error'&&<X className="w-4 h-4 text-red-600"/>}<span className="font-medium">{feedback.text} {feedback.score!==undefined&&`(${feedback.score}%)`}</span></div>{feedback.spokenText&&<button onClick={(e)=>{e.stopPropagation();toggleDetails();}} className="text-xs underline opacity-70 hover:opacity-100">{showDetails?'éš±è—':'è©³æƒ…'}</button>}</div>{showDetails&&<RenderComparison feedback={feedback}/>}</div>)}</div>);};
const VocabCard=({item,colorTheme})=>{const th={blue:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",badge:"bg-blue-100 text-blue-700",icon:"text-blue-500",btn:"bg-blue-600 hover:bg-blue-700"},green:{bg:"bg-green-50",border:"border-green-200",text:"text-green-800",badge:"bg-green-100 text-green-700",icon:"text-green-500",btn:"bg-green-600 hover:bg-green-700"},amber:{bg:"bg-amber-50",border:"border-amber-200",text:"text-amber-800",badge:"bg-amber-100 text-amber-700",icon:"text-amber-500",btn:"bg-amber-600 hover:bg-amber-700"},purple:{bg:"bg-purple-50",border:"border-purple-200",text:"text-purple-800",badge:"bg-purple-100 text-purple-700",icon:"text-purple-500",btn:"bg-purple-600 hover:bg-purple-700"},teal:{bg:"bg-teal-50",border:"border-teal-200",text:"text-teal-800",badge:"bg-teal-100 text-teal-700",icon:"text-teal-500",btn:"bg-teal-600 hover:bg-teal-700"},indigo:{bg:"bg-indigo-50",border:"border-indigo-200",text:"text-indigo-800",badge:"bg-indigo-100 text-indigo-700",icon:"text-indigo-500",btn:"bg-indigo-600 hover:bg-indigo-700"},orange:{bg:"bg-orange-50",border:"border-orange-200",text:"text-orange-800",badge:"bg-orange-100 text-orange-700",icon:"text-orange-500",btn:"bg-orange-600 hover:bg-orange-700"},red:{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",badge:"bg-red-100 text-red-700",icon:"text-red-500",btn:"bg-red-600 hover:bg-red-700"}};const t=th[colorTheme]||th.blue;return(<div onClick={()=>speakText(item.word)} className={`relative flex flex-col justify-between p-5 rounded-xl border-2 ${t.bg} ${t.border} shadow-sm hover:shadow-md transition-all cursor-pointer group hover:-translate-y-1 h-full`}><div className="flex justify-between items-start mb-3"><div><h3 className="text-xl font-bold text-gray-800 group-hover:text-black tracking-wide">{item.word}</h3><span className="text-sm font-medium text-gray-600 block mt-1">{item.mean}</span></div><button className={`w-8 h-8 rounded-full flex items-center justify-center text-white shadow-sm transition-transform group-hover:scale-110 ${t.btn}`}><Volume2 className="w-4 h-4"/></button></div><div className="space-y-3 mt-auto"><div className={`inline-block px-2 py-1 rounded-md text-xs font-bold font-mono ${t.badge} opacity-90`}>{item.kk}</div><div className="text-xs text-gray-600 flex items-start bg-white/60 p-2 rounded-lg backdrop-blur-sm relative"><Info className={`w-3 h-3 mr-1.5 mt-0.5 flex-shrink-0 ${t.icon}`}/><span className="flex-1 leading-snug">{item.tip}</span></div></div></div>);};
const StartScreen=({onStart})=>(<div className="fixed inset-0 z-[9999] bg-slate-900 flex flex-col overflow-y-auto"><div className="min-h-full flex flex-col items-center justify-center p-4"><div className="max-w-md w-full bg-slate-800 rounded-3xl p-6 md:p-8 shadow-2xl border border-slate-700 text-center relative overflow-hidden my-auto"><div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div><div className="w-16 h-16 md:w-20 md:h-20 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-4 md:mb-6 text-blue-400 ring-4 ring-slate-600/50"><i className="fas fa-headset text-3xl md:text-4xl"></i></div><h1 className="text-2xl md:text-3xl font-bold mb-3 tracking-tight text-white">å•†å‹™è‹±èªæœƒè©±ç‰¹è¨“</h1><p className="text-slate-400 mb-6 text-sm leading-relaxed">ç‚ºäº†ç¢ºä¿æœ€ä½³çš„ç·´ç¿’é«”é©—ï¼Œæˆ‘å€‘éœ€è¦å…ˆå–å¾—æ‚¨çš„éº¥å…‹é¢¨æ¬Šé™ã€‚<br/><br/><span className="text-blue-300 font-medium bg-blue-900/30 px-2 py-1 rounded">é»æ“Šä¸€æ¬¡å…è¨±ï¼Œå…¨ç¨‹ç„¡ç¸«ç·´ç¿’</span></p><button onClick={onStart} className="group w-full relative inline-flex items-center justify-center px-6 py-3 md:px-8 md:py-4 text-base md:text-lg font-bold text-white transition-all duration-200 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl shadow-lg hover:shadow-blue-500/30 active:scale-95"><span>é–‹å•Ÿéº¥å…‹é¢¨ä¸¦é–‹å§‹</span><div className="ml-3 flex items-center gap-1 h-4"><div className="wave-bar"></div><div className="wave-bar"></div><div className="wave-bar"></div></div></button><p className="mt-6 text-xs text-slate-500"><i className="fas fa-shield-alt mr-1"></i> æ‚¨çš„éš±ç§å—ä¿è­·ï¼ŒéŒ„éŸ³åƒ…åœ¨ç€è¦½å™¨å…§è™•ç†</p></div></div></div>);
const InterviewPracticeApp=()=>{const[hasStarted,setHasStarted]=useState(false);const[activeTab,setActiveTab]=useState('vocab');const[selectedUnit,setSelectedUnit]=useState('All');const[isBlindMode,setIsBlindMode]=useState(false);const[showChunks,setShowChunks]=useState(false);const[recState,setRecState]=useState({activeId:null,status:'idle',feedbackMap:{}});const[showDetailsMap,setShowDetailsMap]=useState({});const[isLooping,setIsLooping]=useState(false);const[currentPlayingIndex,setCurrentPlayingIndex]=useState(-1);const loopQueueRef=useRef([]);const isLoopingRef=useRef(false);const handleStartApp=async()=>{const r=getSharedRecognition();if(r){try{r.start();setTimeout(()=>{r.stop();setHasStarted(true);},100);}catch(e){console.log("Auto start",e);setHasStarted(true);}}else{alert("ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³");setHasStarted(true);}};const stopGlobalRecording=()=>{if(globalRecognition){try{globalRecognition.stop();}catch(e){}}if(globalTimeout){clearTimeout(globalTimeout);globalTimeout=null;}};const handleStartRecording=(id,targetText,diagnosticsConfig={})=>{stopGlobalRecording();if(isLooping){setIsLooping(false);isLoopingRef.current=false;setCurrentPlayingIndex(-1);window.speechSynthesis.cancel();}if(recState.activeId===id&&(recState.status==='listening'||recState.status==='init')){setRecState(p=>({...p,status:'idle',activeId:null}));return;}const r=getSharedRecognition();if(!r){alert("No Rec");return;}setRecState(p=>({...p,activeId:id,status:'init',feedbackMap:{...p.feedbackMap,[id]:null}}));setShowDetailsMap(p=>({...p,[id]:false}));r.onstart=()=>{setRecState(p=>({...p,status:'listening'}));if(globalTimeout)clearTimeout(globalTimeout);globalTimeout=setTimeout(()=>{try{r.stop();}catch(e){}},20000);};r.onresult=(e)=>{if(globalTimeout)clearTimeout(globalTimeout);const sp=e.results[0][0].transcript;processResult(id,targetText,sp,diagnosticsConfig);};r.onerror=(e)=>{if(globalTimeout)clearTimeout(globalTimeout);if(e.error==='aborted')return;let m='ç„¡æ³•è¾¨è­˜';if(e.error==='not-allowed')m='è«‹æª¢æŸ¥éº¥å…‹é¢¨';setRecState(p=>({...p,status:'idle',feedbackMap:{...p.feedbackMap,[id]:{type:'error',text:m}}}));};r.onend=()=>{setRecState(p=>{if(p.activeId===id)return{...p,status:'idle'};return p;});};try{r.start();}catch(e){try{r.stop();setTimeout(()=>r.start(),100);}catch(er){setRecState(p=>({...p,status:'idle'}));}}};const processResult=(id,tt,sp,dc)=>{const tc=cleanText(tt);const sc=cleanText(sp);const tw=tc.split(' ');const sw=sc.split(' ');const fw=['a','an','the','to','of','in','on','at','is','are','was','were','be','it','that','this','and','but','or','for','with','as'];let mc=0;let missingCW=[];let missingFW=[];tw.forEach(w=>{if(sw.some(x=>x===w||(x.length>3&&(x.includes(w)||w.includes(x))))){mc++;}else{if(fw.includes(w))missingFW.push(w);else missingCW.push(w);}});let acc=0;if(tw.length>0)acc=Math.round((mc/tw.length)*100);if(tw.length<=3){if(sc===tc)acc=100;else acc=(sc===tc)?100:(acc>90?90:acc);}let ft='error';let fm=`è«‹èª¿æ•´ç™¼éŸ³`;let am="";let tf=false;if(dc&&dc.traps){Object.keys(dc.traps).forEach(tk=>{if(sc.includes(tk.toLowerCase())){am=dc.traps[tk];tf=true;}});}if(!tf&&acc<100){if(missingCW.length>0){am=`é—œéµå­— "${missingCW[0]}" ä¸æ¸…æ¥šã€‚`;}else if(missingFW.length>0){am=`é€£éŸ³è¦æ³¨æ„ (å¦‚ ${missingFW[0]})ã€‚`;}else{am=`èªèª¿è«‹å†åŠ å¼·ã€‚`;}}if(acc===100){ft='success';fm=`å®Œç¾ç„¡ç‘•ï¼`;if(navigator.vibrate)navigator.vibrate(50);}else if(acc>=90){ft='success';fm=`å¾ˆå¥½ï¼Œé †æš¢`;}else if(acc>=80){ft='warning';fm=`ä¸éŒ¯ï¼Œæ³¨æ„ç´°ç¯€`;}else if(acc>=60){ft='warning';fm=`èªèª¿æœ‰èª¤`;}else{ft='error';fm=`è«‹æ”¾æ…¢é€Ÿåº¦`;}setRecState(p=>({...p,status:'idle',feedbackMap:{...p.feedbackMap,[id]:{type:ft,text:fm,score:acc,spokenText:sp,targetText:tt,advice:am}}}));setShowDetailsMap(p=>({...p,[id]:true}));};const toggleDetails=(id)=>{setShowDetailsMap(p=>({...p,[id]:!p[id]}));};const closeActiveFeedback=()=>{if(recState.activeId){setRecState(p=>({...p,feedbackMap:{...p.feedbackMap,[p.activeId]:null}}));}};const availableUnits=useMemo(()=>{const u=new Set();vocabData.forEach(s=>s.unitId&&u.add(s.unitId));sentenceData.forEach(s=>s.unitId&&u.add(s.unitId));return['All',...Array.from(u).sort()];},[]);const filteredVocabSections=vocabData.filter(s=>selectedUnit==='All'||s.unitId===selectedUnit);const filteredInterviewData=sentenceData.filter(s=>selectedUnit==='All'||s.unitId===selectedUnit);const toggleLoop=()=>{if(isLooping){setIsLooping(false);isLoopingRef.current=false;setCurrentPlayingIndex(-1);window.speechSynthesis.cancel();}else{const q=[];let gic=0;filteredInterviewData.forEach(s=>{s.sentences.forEach(i=>{q.push({id:i.id,text:i.plain,globalIndex:gic});gic++;});});loopQueueRef.current=q;if(q.length>0){setIsLooping(true);isLoopingRef.current=true;playNextInLoop(0);}}};const playNextInLoop=(idx)=>{if(!isLoopingRef.current)return;if(idx>=loopQueueRef.current.length){playNextInLoop(0);return;}const item=loopQueueRef.current[idx];setCurrentPlayingIndex(idx);speakText(item.text,0.85,()=>{if(isLoopingRef.current){playNextInLoop(idx+1);}});};const handleManualPlay=(t,r)=>{if(isLooping){setIsLooping(false);isLoopingRef.current=false;setCurrentPlayingIndex(-1);loopQueueRef.current=[];}speakText(t,r);};useEffect(()=>{if(isLooping){setIsLooping(false);isLoopingRef.current=false;setCurrentPlayingIndex(-1);window.speechSynthesis.cancel();loopQueueRef.current=[];}},[activeTab,selectedUnit]);const themes={blue:{bg:"bg-blue-50",border:"border-blue-200",title:"text-blue-800",typeTag:"bg-blue-600 text-white",btn:"bg-blue-600 hover:bg-blue-700",icon:"text-blue-600"},green:{bg:"bg-green-50",border:"border-green-200",title:"text-green-800",typeTag:"bg-green-600 text-white",btn:"bg-green-600 hover:bg-green-700",icon:"text-green-600"},amber:{bg:"bg-amber-50",border:"border-amber-200",title:"text-amber-800",typeTag:"bg-amber-600 text-white",btn:"bg-amber-600 hover:bg-amber-700",icon:"text-amber-600"},purple:{bg:"bg-purple-50",border:"border-purple-200",title:"text-purple-800",typeTag:"bg-purple-600 text-white",btn:"bg-purple-600 hover:bg-purple-700",icon:"text-purple-600"},teal:{bg:"bg-teal-50",border:"border-teal-200",title:"text-teal-800",typeTag:"bg-teal-600 text-white",btn:"bg-teal-600 hover:bg-teal-700",icon:"text-teal-600"},indigo:{bg:"bg-indigo-50",border:"border-indigo-200",title:"text-indigo-800",typeTag:"bg-indigo-600 text-white",btn:"bg-indigo-600 hover:bg-indigo-700",icon:"text-indigo-600"},orange:{bg:"bg-orange-50",border:"border-orange-200",title:"text-orange-800",typeTag:"bg-orange-600 text-white",btn:"bg-orange-600 hover:bg-orange-700",icon:"text-orange-600"},red:{bg:"bg-red-50",border:"border-red-200",title:"text-red-800",typeTag:"bg-red-600 text-white",btn:"bg-red-600 hover:bg-red-700",icon:"text-red-600"}};if(!hasStarted)return<StartScreen onStart={handleStartApp}/>;const activeFeedback=recState.activeId?recState.feedbackMap[recState.activeId]:null;const isShowDetails=recState.activeId?showDetailsMap[recState.activeId]:false;return(<div id="app-container" className="relative min-h-screen"><div className="max-w-4xl mx-auto px-4 py-8 animate-fade-in pb-24 md:pb-8"><header className="text-center mb-6"><div className="inline-flex items-center justify-center p-3 bg-white rounded-full shadow-sm mb-4"><Briefcase className="w-8 h-8 text-blue-600 mr-2"/><span className="text-gray-500 font-medium">å•†å‹™è‹±èªå£èªªæ•™ç·´</span></div><h1 className="text-3xl font-bold text-gray-800 mb-2 tracking-tight">å•†å‹™è‹±èªæœƒè©± <span className="text-blue-600">å¯¦æˆ°ç‰¹è¨“ç­</span></h1></header><div className="flex justify-center mb-6"><div className="bg-white p-2 rounded-lg shadow-sm border border-gray-200 flex items-center space-x-2"><Filter className="w-5 h-5 text-gray-500"/><span className="text-sm font-bold text-gray-700">é¸æ“‡å–®å…ƒï¼š</span><select value={selectedUnit} onChange={(e)=>setSelectedUnit(e.target.value)} className="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2 outline-none font-medium"><option value="All">é¡¯ç¤ºå…¨éƒ¨èª²ç¨‹ (Show All)</option>{availableUnits.filter(u=>u!=='All').map(u=><option key={u} value={u}>{u}</option>)}</select></div></div><div className="flex justify-center mb-10"><div className="bg-white p-1 rounded-xl shadow-sm border border-gray-200 flex overflow-x-auto"><button onClick={()=>setActiveTab('vocab')} className={`px-4 md:px-6 py-2 rounded-lg text-sm font-bold transition-all flex items-center whitespace-nowrap ${activeTab==='vocab'?'bg-blue-600 text-white shadow-md':'text-gray-500 hover:bg-gray-50'}`}><BookOpen className="w-4 h-4 mr-2"/>1. å–®å­—ç‰¹è¨“</button><button onClick={()=>setActiveTab('sentences')} className={`px-4 md:px-6 py-2 rounded-lg text-sm font-bold transition-all flex items-center whitespace-nowrap ${activeTab==='sentences'?'bg-green-600 text-white shadow-md':'text-gray-500 hover:bg-gray-50'}`}><MessageCircle className="w-4 h-4 mr-2"/>2. å¥å‹è·Ÿè®€ (V15)</button><button onClick={()=>setActiveTab('prepositions')} className={`px-4 md:px-6 py-2 rounded-lg text-sm font-bold transition-all flex items-center whitespace-nowrap ${activeTab==='prepositions'?'bg-orange-600 text-white shadow-md':'text-gray-500 hover:bg-gray-50'}`}><Link2 className="w-4 h-4 mr-2"/>3. ä»‹ä¿‚è©ç”¨æ³•</button></div></div>{activeTab==='sentences'&&(<div className="sticky top-2 z-20 mb-6 flex justify-center gap-2 flex-wrap"><button onClick={()=>setShowChunks(!showChunks)} className={`px-4 py-2 rounded-full shadow-md text-sm font-bold transition-all flex items-center ${showChunks?'bg-indigo-600 text-white':'bg-white text-gray-600 border border-gray-200'}`}><Scissors className="w-4 h-4 mr-1"/>{showChunks?'éš±è—æ–·å¥':'æ–·å¥è¼”åŠ©'}</button><button onClick={()=>setIsBlindMode(!isBlindMode)} className={`px-4 py-2 rounded-full shadow-md text-sm font-bold transition-all flex items-center ${isBlindMode?'bg-black text-white':'bg-white text-gray-600 border border-gray-200'}`}>{isBlindMode?<EyeOff className="w-4 h-4 mr-1"/>:<Eye className="w-4 h-4 mr-1"/>}{isBlindMode?'ç›²è½æ¨¡å¼ ON':'é®è”½æ–‡å­—'}</button><button onClick={toggleLoop} className={`px-4 py-2 rounded-full shadow-md text-sm font-bold transition-all flex items-center ${isLooping?'bg-purple-600 text-white animate-pulse':'bg-white text-gray-600 border border-gray-200'}`}>{isLooping?<PauseCircle className="w-4 h-4 mr-1"/>:<Repeat className="w-4 h-4 mr-1"/>}{isLooping?'å¾ªç’°æ’­æ”¾ä¸­...':'å¾ªç’°æ’­æ”¾æ•´èª²'}</button></div>)}{activeTab==='vocab'&&(filteredVocabSections.length>0?<div className="space-y-8">{filteredVocabSections.map((s,i)=>{const SI=IconMap[s.icon]||Briefcase;return(<section key={i}><div className="flex items-center mb-4 ml-1"><div className={`p-2 rounded-lg mr-3 bg-${s.color}-100 text-${s.color}-600`}><SI className="w-5 h-5"/></div><div><h2 className="text-xl font-bold text-gray-800">{s.title}</h2><p className="text-sm text-gray-500">{s.desc}</p></div></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">{s.words.map((w,wi)=><VocabCard key={wi} item={w} colorTheme={s.color}/>)}</div></section>);})}</div>:<div className="text-center py-10 text-gray-400 bg-gray-100 rounded-xl">ç„¡è³‡æ–™</div>)}{activeTab==='sentences'&&(filteredInterviewData.length>0?<div className="space-y-8"><div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-sm text-yellow-800 flex flex-col md:flex-row items-start md:items-center justify-between"><div className="flex items-start mb-2 md:mb-0"><MousePointerClick className="w-5 h-5 mr-2 mt-0.5 flex-shrink-0"/><span><strong>å°ˆæ¥­èªæ„Ÿæ¨¡å¼ï¼š</strong> 100% æ­£ç¢ºæ‰æ˜¯åˆæ ¼ã€‚AI æ•™ç·´æœƒè‡ªå‹•åˆ†è¾¨é—œéµå­—èˆ‡è™›å­—ï¼Œçµ¦å‡ºæœ€ç¬¦åˆå•†å‹™æºé€šçš„å»ºè­°ï¼</span></div></div>{filteredInterviewData.map((s,si)=>{const th=themes[s.colorTheme]||themes.blue;const SI=IconMap[s.icon]||MessageCircle;let prevCnt=0;for(let i=0;i<si;i++)prevCnt+=filteredInterviewData[i].sentences.length;return(<section key={s.id} className="bg-white rounded-2xl shadow-sm border border-gray-100"><div className={`px-6 py-4 border-b ${th.border} ${th.bg} flex items-center justify-between rounded-t-2xl`}><div><h2 className={`text-xl font-bold ${th.title} flex items-center`}>{s.category}</h2><p className="text-sm text-gray-600 mt-1 opacity-90">{s.desc}</p></div><SI className={`w-6 h-6 ${th.icon} opacity-50`}/></div><div className="divide-y divide-gray-50">{s.sentences.map((it,idx)=>{const gIdx=prevCnt+idx;const isP=isLooping&&currentPlayingIndex===gIdx;return(<div key={it.id} onClick={()=>handleManualPlay(it.plain,0.85)} className={`group p-6 hover:bg-gray-50 transition-colors cursor-pointer relative ${isP?'playing-card':''}`}><div className="flex flex-col md:flex-row md:items-start justify-between gap-4"><div className="flex-1"><span className={`inline-block text-xs font-bold px-2 py-0.5 rounded mb-2 ${th.typeTag} opacity-80`}>{it.type}</span><div className={`text-xl md:text-2xl text-gray-800 font-serif-en mb-3 ${th.title}`}>{renderChunkedText(it.text,showChunks)}</div><p className={`text-gray-600 font-medium text-sm md:text-base mb-3 transition-opacity ${isBlindMode?'opacity-0 group-hover:opacity-100':'opacity-100'}`}>{it.mean}</p><div className={`inline-flex items-start text-xs md:text-sm text-gray-500 bg-gray-100 px-3 py-2 rounded-lg leading-relaxed transition-opacity ${isBlindMode?'opacity-0 group-hover:opacity-100':'opacity-100'}`}><Info className="w-4 h-4 mr-2 mt-0.5 text-gray-400 flex-shrink-0"/><span>{it.tip}</span></div></div><div className="flex items-center space-x-2 flex-shrink-0 self-end md:self-center mt-4 md:mt-0 opacity-80 group-hover:opacity-100 transition-opacity"><VoiceEvaluatorButton id={it.id} status={recState.activeId===it.id?recState.status:'idle'} feedback={recState.feedbackMap[it.id]} showDetails={showDetailsMap[it.id]} toggleDetails={()=>toggleDetails(it.id)} onRecord={()=>handleStartRecording(it.id,it.plain,{intonation:it.intonation,traps:it.traps})}/><button onClick={(e)=>{e.stopPropagation();handleManualPlay(it.plain,0.75);}} className="flex items-center justify-center h-10 px-3 rounded-full bg-white border border-gray-200 text-green-600 hover:bg-green-50 hover:border-green-200 hover:scale-105 transition-all shadow-sm text-xs font-bold" title="æ…¢é€Ÿ"><Turtle className="w-4 h-4 mr-1"/> 0.75x</button><button onClick={(e)=>{e.stopPropagation();handleManualPlay(it.plain,1.0);}} className={`flex items-center justify-center h-10 px-3 rounded-full text-white hover:scale-105 transition-all shadow-md text-xs font-bold ${th.btn}`} title="åŸé€Ÿ"><Play className="w-4 h-4 mr-1"/> 1.0x</button></div></div></div>);})}</div></section>);})}</div>:<div className="text-center py-10 text-gray-400 bg-gray-100 rounded-xl">ç„¡è³‡æ–™</div>)}{activeTab==='prepositions'&&(prepData.length>0?<div className="space-y-6"><div className="bg-orange-50 border border-orange-200 rounded-2xl p-6 shadow-sm mb-6"><div className="flex items-start gap-4"><div className="bg-orange-100 p-3 rounded-full text-orange-600"><Link2 className="w-8 h-8"/></div><div><h2 className="text-xl font-bold text-orange-900 mb-2">ç‚ºä»€éº¼ä»‹ä¿‚è©å¾ˆé‡è¦ï¼Ÿ</h2><p className="text-orange-800 text-sm leading-relaxed">ä»‹ä¿‚è©æ˜¯å–®å­—é–“çš„ã€Œå¼·åŠ›è† ã€ã€‚é»æ“Šä¸‹æ–¹å¡ç‰‡ï¼Œæ³¨æ„ç²—é«”å­—çš„ã€Œé€£éŸ³ã€ï¼</p></div></div></div><div className="grid grid-cols-1 md:grid-cols-2 gap-6">{prepData.map((it)=>(<div key={it.id} onClick={()=>speakText(it.plain)} className="bg-white rounded-xl shadow-sm border border-orange-100 p-5 hover:shadow-md hover:border-orange-300 transition-all cursor-pointer group flex flex-col"><div className="flex justify-between items-start mb-3"><span className="inline-block px-3 py-1 bg-orange-100 text-orange-700 text-sm font-bold rounded-full">{it.phrase}</span><div className="flex items-center gap-2"><VoiceEvaluatorButton id={it.id} status={recState.activeId===it.id?recState.status:'idle'} feedback={recState.feedbackMap[it.id]} showDetails={showDetailsMap[it.id]} toggleDetails={()=>toggleDetails(it.id)} onRecord={()=>handleStartRecording(it.id,it.plain)}/><Volume2 className="w-5 h-5 text-gray-300 group-hover:text-orange-500 transition-colors"/></div></div><div className="mb-4 flex-grow"><h3 className="text-lg md:text-xl text-gray-800 font-serif-en mb-2 leading-relaxed"><InteractiveSentence htmlContent={it.sentence} isBlindMode={false}/></h3><p className="text-gray-500 text-sm font-medium">{it.mean}</p></div><div className="mt-auto pt-3 border-t border-gray-50"><div className="flex items-start text-xs text-orange-600 bg-orange-50 p-2 rounded-lg"><Zap className="w-3 h-3 mr-1.5 mt-0.5 flex-shrink-0"/>{it.tip}</div></div></div>))}</div></div>:<div className="text-center py-10 text-gray-400 bg-gray-100 rounded-xl">ç„¡è³‡æ–™</div>)}</div><MobileFeedbackToast feedback={activeFeedback} showDetails={isShowDetails} toggleDetails={()=>toggleDetails(recState.activeId)} onClose={closeActiveFeedback}/></div>);};const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<InterviewPracticeApp/>);
</script>
</body>
</html>
